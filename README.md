# OpenTracingDiagram
_Use traces to describe micro-services architecture._

## The problem and the idea
Microservices architectures are complex, it's never easy to write and maintain documention around it. With initiatives such as OpenTracing or OpenCensus, traces are easier and easier to get. So what about use traces to infer architecture ? However, unless we know exactly what we are looking for in traces, too much traces kill the traces... And it's exactly what is happening with traces. So we weed something on top to make some sense of them.

This project is a tiny PoC that goes toward that goal. It builds a sequence diagram from jaeger traces and display it in a Grafana dashboard. It's not much but still it can be useful.
**Disclaimer:** the idea initial is from: https://danlebrero.com/2017/04/06/documenting-your-architecture-wireshark-plantuml-and-a-repl/

## The PoC

The transformation is done in Clojure. One file [handler.clj](https://github.com/alexvaut/OpenTracingDiagram/blob/master/jaeger2diag/src/jaeger2diag/handler.clj) of few hundreds lines, Swagger UI included and Grafana source API too ! Indeed, for Grafana to get access to the traces metadata (service name...), an API compatible with [Grafana simple json datasource](https://grafana.com/plugins/grafana-simple-json-datasource/installation) is provided.

The traces are generated by an extension of akka.net (akka.net is an actor framework for .NET derived from akka in the java world) of this project: https://github.com/alexvaut/akka.opentracing. The example is generating fake requests every 5 seconds that trigger jobs, sub processes, storage operations... No need to know the details, the idea is to discover and understand it from the traces !

### How to run it

```
git clone https://github.com/alexvaut/OpenTracingDiagram.git
cd OpenTracingDiagram
docker-compose up
```
Wait a bit for all the containers to be up and then:
- Browse to http://localhost:16686 to see traces in jeager.
- Browse to http://localhost:3000 to see the service transformation API in a Swagger UI. Allow a couple of seconds to the Clojure Ring server to start.
- Browse to http://localhost:3001/d/mddcLWmWk/sequence-diagram-from-traces to see the grafana dashboard where sequence diagrams are displayed. Click on refresh (top-right of the grafana screen) to display a new sequence diagram: jaeger is returning random traces when filtering them, by default only one trace is displayed, you can increase this limit on the dashboard, it's a grafana variable.

## Screenshots

Commin soon...
